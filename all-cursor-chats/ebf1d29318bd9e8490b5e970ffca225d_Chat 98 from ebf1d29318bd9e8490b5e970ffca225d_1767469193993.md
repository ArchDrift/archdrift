# Chat: Chat 98 from ebf1d29318bd9e8490b5e970ffca225d

**Source:** ebf1d29318bd9e8490b5e970ffca225d/aiService.prompts
**Messages:** 1
**Recovered:** 2026-01-03T19:39:53.993Z

---

## unknown

Create the Rule Folder: If it doesn't exist, create a folder named .cursor/rules/ in your root directory.

Create the MDC Rule: Inside that folder, create a file named scoring-logic.mdc.

Paste the "Law of the Engine": Use the content below. This ensures the Agent always prioritizes your density-based logarithmic scoring over the old linear model.

Markdown

---
description: Formal definition of the Structural Integrity Index (SII) and scoring weights.
globs: src/engine/**/*.ts, src/analyzer/**/*.ts
alwaysApply: true
---

# DriftGuard Scoring Logic (Proportional Strict Mode)

## 1. Core Weighted Debt
- **Layer Violation:** 10 points (Fatal)
- **God Class Monolith (1501+ LOC):** 5 points (Critical)
- **N+1 Query:** 2 points (Reduced weight to account for DataLoaders)

## 2. Structural Integrity Index (SII) Formula
Always use the **Density-Based** model with a **Logarithmic Floor**:

1. **WeightedViolations** = (Monoliths × 5) + (N1 × 2) + (Layer × 10)
2. **ViolationDensity** = WeightedViolations / TotalProductionFiles
3. **BaseScore** = 100 - (ViolationDensity × 100)
4. **LogarithmicFloor**:
   - If Density ≤ 1: `40 + (60 * e^(-Density * 2))`
   - If Density > 1: `40 + (10 * e^(-(Density - 1) * 0.5))`
5. **Final Score** = `max(BaseScore, LogarithmicFloor)`

## 3. Special Context
- **Isolation Bonus:** Reduce penalty if violations are in strictly isolated directories.
- **Debt Velocity:** Newness of code increases weight; old stable code has lower drift impact.
- **Test Files:** Scan but do NOT include in the SII calculation.

---

