# Chat: Chat 8 from ebf1d29318bd9e8490b5e970ffca225d

**Source:** ebf1d29318bd9e8490b5e970ffca225d/aiService.prompts
**Messages:** 1
**Recovered:** 2026-01-03T19:39:53.689Z

---

## unknown

Now extend src/analyzer.ts and src/extension.ts to add a third rule: Layer Integrity.

Use this specification:

Infer the ‚Äúlayer‚Äù of a source file from its path:

API layer if the path contains /api/, /presentation/, or /controllers/.

Domain layer if the path contains /domain/, /core/, or /usecases/.

Infra layer if the path contains /infra/, /infrastructure/, /persistence/, or /adapters/.

If no pattern matches, treat the file as unclassified and skip layer checks.

Forbidden dependencies (edges):

domain ‚Üí api (forbidden)

infra ‚Üí api (forbidden)

infra ‚Üí domain (forbidden)

Scan each file‚Äôs text for import/require statements:

JS/TS: import ... from '...';, const X = require('...').

Python: import x.y / from x.y import z.

Java: import a.b.c.*; etc.

Go: import "module/path"

For each import: infer the target layer by applying the same path‚Äëpattern rules to the imported module string (or resolved relative path).

If (sourceLayer, targetLayer) is one of the forbidden edges, record a layer violation with line number and import snippet.

Integration requirements:

Add a function in analyzer.ts that returns an array of layer violations for a given document.

In extension.ts, incorporate these into the diagnostic collection with a message like:

Layer violation: {sourceLayer} module importing from {targetLayer} ("{importText}"). According to DriftGuard‚Äôs default rules, {sourceLayer} must not depend on {targetLayer}.

Update the status bar logic with this priority:

If any layer violations: show üö´ DriftGuard: Layer violations (N).

Else if oversized: show üö® DriftGuard: Oversized (N lines).

Else if N+1: show ‚ö† DriftGuard: N+1 hotspots (K).

Else: ‚úÖ DriftGuard: Clean.

Update src/test/analyzer.test.ts with tests that cover at least:

A domain file importing from api (violation).

An infra file importing from domain (violation).

A domain file importing from infra (allowed in this version).

Keep performance acceptable (linear in lines). Do not introduce any new dependencies beyond those already added.

---

