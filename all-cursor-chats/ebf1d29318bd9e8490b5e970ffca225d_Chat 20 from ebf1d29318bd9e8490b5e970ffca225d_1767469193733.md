# Chat: Chat 20 from ebf1d29318bd9e8490b5e970ffca225d

**Source:** ebf1d29318bd9e8490b5e970ffca225d/aiService.prompts
**Messages:** 1
**Recovered:** 2026-01-03T19:39:53.733Z

---

## unknown

```
/**
 * TO FIX: Layer Detection failing on Windows Absolute Paths
 * * PROBLEM: detectLayer(filePath) fails because it expects relative paths (unit test style),
 * but VS Code provides C:\Users\Name\Project\src\lib\file.ts.
 */

import * as path from 'path';

export function getNormalizedRelativePath(absolutePath: string, rootPath: string): string {
  // 1. Calculate path relative to project root
  // Result: src/lib/lexical.js (regardless of where the project is downloaded)
  let relativePath = path.relative(rootPath, absolutePath);

  // 2. Force Forward Slashes (Windows fix)
  // Replaces all '\' with '/' so the regex/string checks like '.includes("/lib/")' work.
  return relativePath.split(path.sep).join('/');
}

// Now use THIS path for the layer detection logic:
// const layer = detectLayer(getNormalizedRelativePath(fullPath, workspaceRoot));
```

---

