# Chat: Chat 1 from ebf1d29318bd9e8490b5e970ffca225d

**Source:** ebf1d29318bd9e8490b5e970ffca225d/aiService.prompts
**Messages:** 1
**Recovered:** 2026-01-03T19:39:53.668Z

---

## unknown

Here‚Äôs a clean, self-contained description you can hand to a competent coder so they can build **exactly the first thing you want shipped**, without knowing any of your prior philosophy or projects.

***

## 1. What This Thing Is

You are building a **Visual Studio Code extension** called **‚ÄúDriftGuard‚Äù**.

- It runs **inside VS Code** while developers are editing code.
- It **analyzes the currently open file** and **highlights two kinds of problems**:
  1. Files that are so large they are likely ‚ÄúGod classes.‚Äù
  2. Places where database/API calls are made inside loops (classic N+1 query pattern).

This is **not** a full ‚Äúarchitecture engine.‚Äù  
This is **Version 0.1**: a simple, always-on **code smell detector** that gives developers **immediate visual feedback** in the editor.

***

## 2. Who It‚Äôs For / How It Feels

Audience: Regular developers using VS Code or Cursor, writing backend or full‚Äëstack code.

The experience you want them to have:

- They install the extension.
- They open a code file.
- **Without configuring anything**, they automatically see:
  - A **big warning** in the status bar if the file is too big.
  - **Colored underlines** and warnings on lines where they are probably doing N+1 database/API calls inside loops.
- It should feel like: ‚ÄúSonar-like hints, but lightweight and instant, right in my editor.‚Äù

No config. No setup. No reading docs. It just works.

***

## 3. What It Detects (Rules)

### Rule 1: ‚ÄúGod Class‚Äù / Oversized File

Purpose: Flag files that are too big to be healthy.

Behavior:

- For every file the user opens or saves, count how many **actual code lines** it has:
  - Count non-empty lines.
  - Ignore:
    - Empty lines.
    - Single-line comments (`//`, `#`).
    - Block comments (`/* ... */`).
- If the file has **more than 500 code lines**, it is considered a **‚ÄúGod Class‚Äù** for this tool.

User-facing behavior when this happens:

- A **warning diagnostic** is created for the whole file.
- The editor shows:
  - A wavy underline (or similar) across the whole file.
  - When the user hovers anywhere in the file, they see a message like:

    > ‚Äúüö® God Class detected (612 code lines). Consider splitting into smaller modules. Threshold: 500 lines.‚Äù

- A **status bar item** appears on the right side with text like:

  > ‚Äúüö® God Class (612 lines)‚Äù

- If the file is below or equal to 500 lines, the status bar should show something like:

  > ‚Äú‚úÖ Clean (N lines)‚Äù

  where N is the count of code lines.

Supported file types for this rule:

- `.js`, `.ts`, `.jsx`, `.tsx`, `.py`, `.java`, `.go`  
  (Anything not in this list can be ignored.)

When the rule runs:

- Automatically on:
  - File open.
  - File save.
- Also via a **manual command** (e.g., ‚ÄúDriftGuard: Scan Active File‚Äù) available from the Command Palette.

***

### Rule 2: ‚ÄúN+1 Query‚Äù / DB/API Calls Inside Loops

Purpose: Flag likely performance problems where code is doing database or API calls inside loops.

Behavior:

- For a scanned file, look at each line and identify **loops**:
  - Rough patterns to treat as loops:
    - `for (...)`
    - `while (...)`
    - `array.map(...)`
    - `array.filter(...)`
    - `array.forEach(...)`
- While the scanner is ‚Äúinside‚Äù a loop (from the loop start line until the loop‚Äôs closing brace), look for **calls that are likely DB/API requests**, for example:
  - Lines containing `await` plus method calls like:
    - `.query(`, `.find(`, `.findOne(`, `.findById(`, `.save(`, `.update(`, `.delete(`, `.create(`)
  - Or containing:
    - `fetch(`
    - `axios.get`, `axios.post`, `axios.put`, `axios.delete`
    - `prisma.` (typical Prisma ORM)
    - `db.` (generic db access)
- For each line inside a loop that matches these patterns, treat it as an N+1 **violation**.

User-facing behavior for violations:

- Each violating line gets a **warning diagnostic**.
- That line is underlined or highlighted.
- Hovering on that line shows a message like:

  > ‚Äú‚ö†Ô∏è N+1 Query: Database/API call inside loop. Consider batching queries or moving the call outside the loop.‚Äù

- If at least one N+1 violation exists and the file is **not** already flagged as God Class, the status bar text can change to something like:

  > ‚Äú‚ö†Ô∏è N+1 Queries (3 locations)‚Äù

Supported file types:

- Same as Rule 1 (`.js`, `.ts`, `.jsx`, `.tsx`, `.py`, `.java`, `.go`) is fine for v0.1, even though some patterns are JS-focused.

When this rule runs:

- Same as Rule 1:
  - On file open.
  - On file save.
  - On manual ‚ÄúScan Active File‚Äù command.

***

## 4. How It Integrates Into VS Code

High-level extension behavior:

- **Activation:**
  - The extension activates when VS Code starts up or when any supported file is opened.
- **Diagnostics:**
  - It uses VS Code‚Äôs diagnostics mechanism to:
    - Attach warnings to files and specific lines.
    - Display them in the ‚ÄúProblems‚Äù panel.
- **Status Bar:**
  - It owns a single status bar item on the right that:
    - Shows a warning or OK state per active file.
    - Updates whenever the active editor changes or the file is scanned.
- **Commands:**
  - At least one command is exposed:
    - ‚ÄúDriftGuard: Scan Active File‚Äù
  - This command is callable from:
    - The Command Palette.
    - Optionally a keybinding (e.g., Ctrl+Shift+G, but exact binding is not critical).

***

## 5. Project Shape (How You Expect It Organized)

Even though you don‚Äôt want code here, the developer should know the **conceptual layout**:

- One file that handles:
  - Activation / deactivation of the extension.
  - Wiring VS Code events:
    - On document open.
    - On document save.
    - On active editor change.
    - On manual command invocation.
  - Invoking your two checks and pushing diagnostics + updating status bar.

- One file that‚Äôs **pure logic**:
  - Takes a VS Code text document (or equivalent text input).
  - Returns:
    - For Rule 1: Whether it‚Äôs a God Class and what the code line count is.
    - For Rule 2: Whether it has N+1 patterns and a list of line numbers where violations occur.

No external services. No config files exposed to users. Everything works locally in the editor.

***

## 6. What ‚ÄúDone‚Äù Looks Like for v0.1

A developer can:

1. Clone the repo.
2. Install dependencies.
3. Launch the extension in an Extension Development Host.
4. Open:
   - A small file ‚Üí sees ‚Äú‚úÖ Clean (N lines)‚Äù and no warnings.
   - A 600-line file ‚Üí sees:
     - A God Class warning in the editor and status bar.
   - A file with loops and DB/API calls inside those loops ‚Üí sees:
     - Line-level warnings on those lines.
     - N+1 summary in the status bar (if no God Class warning).

There is:

- A short README that:
  - Explains what DriftGuard does.
  - Lists the two rules (God Class & N+1).
  - Explains how to run in VS Code (Extension Development Host).
- No configuration required for the user.

***

## 7. If You Want to Add Extra Context for the Coder

You can optionally tell them:

- This is **only v0.1**.
- Future versions will add:
  - Deeper architectural invariants (layer boundaries, etc.).
  - Possibly stricter ‚Äúblocking‚Äù behavior.
- For now, you are building:
  - A **fast, visual, always-on smell detector** that runs locally in VS Code and gives hints, not hard blocks.

If you paste this description into a brief for a competent TypeScript/VS Code-extension developer, they should be able to build exactly what you want as the first shipped artifact.

[1](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/87529099/179a90ce-f98a-4b6c-aa81-9bb0e122775f/image.jpg)
[2](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/87529099/334b9707-9563-494a-90ce-7d8c710b1115/image.jpg)
[3](https://code.visualstudio.com/api/advanced-topics/extension-host)
[4](https://www.reddit.com/r/vscode/comments/17p5pbr/unable_to_run_extension_as_extension_development/)
[5](https://code.visualstudio.com/api/get-started/your-first-extension)
[6](https://stackoverflow.com/questions/75759492/vs-code-extension-not-loading-in-extension-development-host)
[7](https://vscode-docs.readthedocs.io/en/stable/extensions/debugging-extensions/)
[8](https://dev.to/lovestaco/the-n1-query-problem-the-silent-performance-killer-2b1c)
[9](https://snyk.io/blog/modern-vs-code-extension-development-tutorial/)
[10](https://blog.appsignal.com/2020/06/09/n-plus-one-queries-explained.html)
[11](https://www.youtube.com/watch?v=cHQo26fdx_o)
[12](https://docs.sentry.io/product/issues/issue-details/performance-issues/n-one-queries/)

---

