# Chat: Chat 15 from ebf1d29318bd9e8490b5e970ffca225d

**Source:** ebf1d29318bd9e8490b5e970ffca225d/aiService.prompts
**Messages:** 1
**Recovered:** 2026-01-03T19:39:53.707Z

---

## unknown

Use this as a precise tuning spec for DriftGuard.

I ran DriftGuard on the Ghost repo and confirmed:

God Class detection works on large JS/TS/TSX files (MemberRepository.js, PostsStatsService.js, use-activity-pub-queries.ts, filters.tsx).

N+1 detection works on both direct and indirect DB patterns and correctly ignores migration files.

The only clear false negatives are layer violations where services/** and lib/** import from api/**.

Please only adjust the layer-violation logic, not the God Class or N+1 rules.

Concretely:

In src/analyzer.ts (or wherever layer analysis lives), add a configurable mapping for Ghost-style layers:

API layer: paths matching **/api/**

Service layer: **/services/**

Model layer: **/models/**

Lib/infra layer: **/lib/** (and optionally **/adapters/**)

Implement import checks so that:

services/** importing from api/** is a layer violation.

lib/** importing from api/** is a layer violation.

(Keep the allowed directions: api → services/models/lib, services → models/lib, etc.)

Add small fixture files and tests that mimic the Ghost examples:

A service file under core/server/services/... that imports from core/server/api/... → expect a layer-violation diagnostic.

A lib file under core/server/lib/... that imports from core/server/api/... → expect a layer-violation diagnostic.

Keep existing God Class and N+1 tests passing; do not change those thresholds or patterns yet.

After changing the analyzer, re-run the tests and show me the new layer-violation tests passing.

The goal of this change:

No behavior change for God Class and N+1.

New behavior: DriftGuard now flags imports like:

services/email-service/EmailServiceWrapper.js → ../../api/endpoints/.../serializers/...

lib/lexical.js → ../api/endpoints/utils/serializers/output/posts

---

